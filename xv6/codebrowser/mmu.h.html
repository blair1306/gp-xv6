<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>mmu.h source code [codebrowser/mmu.h] - Woboq Code Browser</title>
<meta name="woboq:interestingDefinitions" content="gatedesc,segdesc,taskstate "/>
<link rel="stylesheet" href="../../data/qtcreator.css" title="QtCreator"/>
<link rel="alternate stylesheet" href="../../data/kdevelop.css" title="KDevelop"/>
<script type="text/javascript" src="../../data/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../../data/jquery/jquery-ui.min.js"></script>
<script>var file = 'codebrowser/mmu.h'; var root_path = '..'; var data_path = '../../data';</script>
<script src='../../data/codebrowser.js'></script>
</head>
<body><div id='header'><h1 id='breadcrumb'><span>Browse the source code of </span><a href='./'>codebrowser</a>/<a href='mmu.h.html'>mmu.h</a></h1></div>
<hr/><div id='content'><table class="code">
<tr><th id="1">1</th><td><i>// This file contains definitions for the </i></td></tr>
<tr><th id="2">2</th><td><i>// x86 memory management unit (MMU).</i></td></tr>
<tr><th id="3">3</th><td><i></i></td></tr>
<tr><th id="4">4</th><td><i>// Eflags register</i></td></tr>
<tr><th id="5">5</th><td><u>#define <dfn class="macro" id="_M/FL_CF" data-ref="_M/FL_CF">FL_CF</dfn>           0x00000001      // Carry Flag</u></td></tr>
<tr><th id="6">6</th><td><u>#define <dfn class="macro" id="_M/FL_PF" data-ref="_M/FL_PF">FL_PF</dfn>           0x00000004      // Parity Flag</u></td></tr>
<tr><th id="7">7</th><td><u>#define <dfn class="macro" id="_M/FL_AF" data-ref="_M/FL_AF">FL_AF</dfn>           0x00000010      // Auxiliary carry Flag</u></td></tr>
<tr><th id="8">8</th><td><u>#define <dfn class="macro" id="_M/FL_ZF" data-ref="_M/FL_ZF">FL_ZF</dfn>           0x00000040      // Zero Flag</u></td></tr>
<tr><th id="9">9</th><td><u>#define <dfn class="macro" id="_M/FL_SF" data-ref="_M/FL_SF">FL_SF</dfn>           0x00000080      // Sign Flag</u></td></tr>
<tr><th id="10">10</th><td><u>#define <dfn class="macro" id="_M/FL_TF" data-ref="_M/FL_TF">FL_TF</dfn>           0x00000100      // Trap Flag</u></td></tr>
<tr><th id="11">11</th><td><u>#define <dfn class="macro" id="_M/FL_IF" data-ref="_M/FL_IF">FL_IF</dfn>           0x00000200      // Interrupt Enable</u></td></tr>
<tr><th id="12">12</th><td><u>#define <dfn class="macro" id="_M/FL_DF" data-ref="_M/FL_DF">FL_DF</dfn>           0x00000400      // Direction Flag</u></td></tr>
<tr><th id="13">13</th><td><u>#define <dfn class="macro" id="_M/FL_OF" data-ref="_M/FL_OF">FL_OF</dfn>           0x00000800      // Overflow Flag</u></td></tr>
<tr><th id="14">14</th><td><u>#define <dfn class="macro" id="_M/FL_IOPL_MASK" data-ref="_M/FL_IOPL_MASK">FL_IOPL_MASK</dfn>    0x00003000      // I/O Privilege Level bitmask</u></td></tr>
<tr><th id="15">15</th><td><u>#define <dfn class="macro" id="_M/FL_IOPL_0" data-ref="_M/FL_IOPL_0">FL_IOPL_0</dfn>       0x00000000      //   IOPL == 0</u></td></tr>
<tr><th id="16">16</th><td><u>#define <dfn class="macro" id="_M/FL_IOPL_1" data-ref="_M/FL_IOPL_1">FL_IOPL_1</dfn>       0x00001000      //   IOPL == 1</u></td></tr>
<tr><th id="17">17</th><td><u>#define <dfn class="macro" id="_M/FL_IOPL_2" data-ref="_M/FL_IOPL_2">FL_IOPL_2</dfn>       0x00002000      //   IOPL == 2</u></td></tr>
<tr><th id="18">18</th><td><u>#define <dfn class="macro" id="_M/FL_IOPL_3" data-ref="_M/FL_IOPL_3">FL_IOPL_3</dfn>       0x00003000      //   IOPL == 3</u></td></tr>
<tr><th id="19">19</th><td><u>#define <dfn class="macro" id="_M/FL_NT" data-ref="_M/FL_NT">FL_NT</dfn>           0x00004000      // Nested Task</u></td></tr>
<tr><th id="20">20</th><td><u>#define <dfn class="macro" id="_M/FL_RF" data-ref="_M/FL_RF">FL_RF</dfn>           0x00010000      // Resume Flag</u></td></tr>
<tr><th id="21">21</th><td><u>#define <dfn class="macro" id="_M/FL_VM" data-ref="_M/FL_VM">FL_VM</dfn>           0x00020000      // Virtual 8086 mode</u></td></tr>
<tr><th id="22">22</th><td><u>#define <dfn class="macro" id="_M/FL_AC" data-ref="_M/FL_AC">FL_AC</dfn>           0x00040000      // Alignment Check</u></td></tr>
<tr><th id="23">23</th><td><u>#define <dfn class="macro" id="_M/FL_VIF" data-ref="_M/FL_VIF">FL_VIF</dfn>          0x00080000      // Virtual Interrupt Flag</u></td></tr>
<tr><th id="24">24</th><td><u>#define <dfn class="macro" id="_M/FL_VIP" data-ref="_M/FL_VIP">FL_VIP</dfn>          0x00100000      // Virtual Interrupt Pending</u></td></tr>
<tr><th id="25">25</th><td><u>#define <dfn class="macro" id="_M/FL_ID" data-ref="_M/FL_ID">FL_ID</dfn>           0x00200000      // ID flag</u></td></tr>
<tr><th id="26">26</th><td></td></tr>
<tr><th id="27">27</th><td><i>// Control Register flags</i></td></tr>
<tr><th id="28">28</th><td><u>#define <dfn class="macro" id="_M/CR0_PE" data-ref="_M/CR0_PE">CR0_PE</dfn>          0x00000001      // Protection Enable</u></td></tr>
<tr><th id="29">29</th><td><u>#define <dfn class="macro" id="_M/CR0_MP" data-ref="_M/CR0_MP">CR0_MP</dfn>          0x00000002      // Monitor coProcessor</u></td></tr>
<tr><th id="30">30</th><td><u>#define <dfn class="macro" id="_M/CR0_EM" data-ref="_M/CR0_EM">CR0_EM</dfn>          0x00000004      // Emulation</u></td></tr>
<tr><th id="31">31</th><td><u>#define <dfn class="macro" id="_M/CR0_TS" data-ref="_M/CR0_TS">CR0_TS</dfn>          0x00000008      // Task Switched</u></td></tr>
<tr><th id="32">32</th><td><u>#define <dfn class="macro" id="_M/CR0_ET" data-ref="_M/CR0_ET">CR0_ET</dfn>          0x00000010      // Extension Type</u></td></tr>
<tr><th id="33">33</th><td><u>#define <dfn class="macro" id="_M/CR0_NE" data-ref="_M/CR0_NE">CR0_NE</dfn>          0x00000020      // Numeric Errror</u></td></tr>
<tr><th id="34">34</th><td><u>#define <dfn class="macro" id="_M/CR0_WP" data-ref="_M/CR0_WP">CR0_WP</dfn>          0x00010000      // Write Protect</u></td></tr>
<tr><th id="35">35</th><td><u>#define <dfn class="macro" id="_M/CR0_AM" data-ref="_M/CR0_AM">CR0_AM</dfn>          0x00040000      // Alignment Mask</u></td></tr>
<tr><th id="36">36</th><td><u>#define <dfn class="macro" id="_M/CR0_NW" data-ref="_M/CR0_NW">CR0_NW</dfn>          0x20000000      // Not Writethrough</u></td></tr>
<tr><th id="37">37</th><td><u>#define <dfn class="macro" id="_M/CR0_CD" data-ref="_M/CR0_CD">CR0_CD</dfn>          0x40000000      // Cache Disable</u></td></tr>
<tr><th id="38">38</th><td><u>#define <dfn class="macro" id="_M/CR0_PG" data-ref="_M/CR0_PG">CR0_PG</dfn>          0x80000000      // Paging</u></td></tr>
<tr><th id="39">39</th><td></td></tr>
<tr><th id="40">40</th><td><u>#define <dfn class="macro" id="_M/CR4_PSE" data-ref="_M/CR4_PSE">CR4_PSE</dfn>         0x00000010      // Page size extension</u></td></tr>
<tr><th id="41">41</th><td></td></tr>
<tr><th id="42">42</th><td><u>#define <dfn class="macro" id="_M/SEG_KCODE" data-ref="_M/SEG_KCODE">SEG_KCODE</dfn> 1  // kernel code</u></td></tr>
<tr><th id="43">43</th><td><u>#define <dfn class="macro" id="_M/SEG_KDATA" data-ref="_M/SEG_KDATA">SEG_KDATA</dfn> 2  // kernel data+stack</u></td></tr>
<tr><th id="44">44</th><td><u>#define <dfn class="macro" id="_M/SEG_KCPU" data-ref="_M/SEG_KCPU">SEG_KCPU</dfn>  3  // kernel per-cpu data</u></td></tr>
<tr><th id="45">45</th><td><u>#define <dfn class="macro" id="_M/SEG_UCODE" data-ref="_M/SEG_UCODE">SEG_UCODE</dfn> 4  // user code</u></td></tr>
<tr><th id="46">46</th><td><u>#define <dfn class="macro" id="_M/SEG_UDATA" data-ref="_M/SEG_UDATA">SEG_UDATA</dfn> 5  // user data+stack</u></td></tr>
<tr><th id="47">47</th><td><u>#define <dfn class="macro" id="_M/SEG_TSS" data-ref="_M/SEG_TSS">SEG_TSS</dfn>   6  // this process's task state</u></td></tr>
<tr><th id="48">48</th><td></td></tr>
<tr><th id="49">49</th><td><i>//PAGEBREAK!</i></td></tr>
<tr><th id="50">50</th><td><u>#<span data-ppcond="50">ifndef</span> <span class="macro" data-ref="_M/__ASSEMBLER__">__ASSEMBLER__</span></u></td></tr>
<tr><th id="51">51</th><td><i>// Segment Descriptor</i></td></tr>
<tr><th id="52">52</th><td><b>struct</b> <dfn class="type def" id="segdesc" title='segdesc' data-ref="segdesc">segdesc</dfn> {</td></tr>
<tr><th id="53">53</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::lim_15_0" title='segdesc::lim_15_0' data-ref="segdesc::lim_15_0">lim_15_0</dfn> : <var>16</var>;  <i>// Low bits of segment limit</i></td></tr>
<tr><th id="54">54</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::base_15_0" title='segdesc::base_15_0' data-ref="segdesc::base_15_0">base_15_0</dfn> : <var>16</var>; <i>// Low bits of segment base address</i></td></tr>
<tr><th id="55">55</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::base_23_16" title='segdesc::base_23_16' data-ref="segdesc::base_23_16">base_23_16</dfn> : <var>8</var>; <i>// Middle bits of segment base address</i></td></tr>
<tr><th id="56">56</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::type" title='segdesc::type' data-ref="segdesc::type">type</dfn> : <var>4</var>;       <i>// Segment type (see STS_ constants)</i></td></tr>
<tr><th id="57">57</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::s" title='segdesc::s' data-ref="segdesc::s">s</dfn> : <var>1</var>;          <i>// 0 = system, 1 = application</i></td></tr>
<tr><th id="58">58</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::dpl" title='segdesc::dpl' data-ref="segdesc::dpl">dpl</dfn> : <var>2</var>;        <i>// Descriptor Privilege Level</i></td></tr>
<tr><th id="59">59</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::p" title='segdesc::p' data-ref="segdesc::p">p</dfn> : <var>1</var>;          <i>// Present</i></td></tr>
<tr><th id="60">60</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::lim_19_16" title='segdesc::lim_19_16' data-ref="segdesc::lim_19_16">lim_19_16</dfn> : <var>4</var>;  <i>// High bits of segment limit</i></td></tr>
<tr><th id="61">61</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::avl" title='segdesc::avl' data-ref="segdesc::avl">avl</dfn> : <var>1</var>;        <i>// Unused (available for software use)</i></td></tr>
<tr><th id="62">62</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::rsv1" title='segdesc::rsv1' data-ref="segdesc::rsv1">rsv1</dfn> : <var>1</var>;       <i>// Reserved</i></td></tr>
<tr><th id="63">63</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::db" title='segdesc::db' data-ref="segdesc::db">db</dfn> : <var>1</var>;         <i>// 0 = 16-bit segment, 1 = 32-bit segment</i></td></tr>
<tr><th id="64">64</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::g" title='segdesc::g' data-ref="segdesc::g">g</dfn> : <var>1</var>;          <i>// Granularity: limit scaled by 4K when set</i></td></tr>
<tr><th id="65">65</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="segdesc::base_31_24" title='segdesc::base_31_24' data-ref="segdesc::base_31_24">base_31_24</dfn> : <var>8</var>; <i>// High bits of segment base address</i></td></tr>
<tr><th id="66">66</th><td>};</td></tr>
<tr><th id="67">67</th><td></td></tr>
<tr><th id="68">68</th><td><i>// Normal segment</i></td></tr>
<tr><th id="69">69</th><td><u>#define <dfn class="macro" id="_M/SEG" data-ref="_M/SEG">SEG</dfn>(type, base, lim, dpl) (struct segdesc)    \</u></td></tr>
<tr><th id="70">70</th><td><u>{ ((lim) &gt;&gt; 12) &amp; 0xffff, (uint)(base) &amp; 0xffff,      \</u></td></tr>
<tr><th id="71">71</th><td><u>  ((uint)(base) &gt;&gt; 16) &amp; 0xff, type, 1, dpl, 1,       \</u></td></tr>
<tr><th id="72">72</th><td><u>  (uint)(lim) &gt;&gt; 28, 0, 0, 1, 1, (uint)(base) &gt;&gt; 24 }</u></td></tr>
<tr><th id="73">73</th><td><u>#define <dfn class="macro" id="_M/SEG16" data-ref="_M/SEG16">SEG16</dfn>(type, base, lim, dpl) (struct segdesc)  \</u></td></tr>
<tr><th id="74">74</th><td><u>{ (lim) &amp; 0xffff, (uint)(base) &amp; 0xffff,              \</u></td></tr>
<tr><th id="75">75</th><td><u>  ((uint)(base) &gt;&gt; 16) &amp; 0xff, type, 1, dpl, 1,       \</u></td></tr>
<tr><th id="76">76</th><td><u>  (uint)(lim) &gt;&gt; 16, 0, 0, 1, 0, (uint)(base) &gt;&gt; 24 }</u></td></tr>
<tr><th id="77">77</th><td><u>#<span data-ppcond="50">endif</span></u></td></tr>
<tr><th id="78">78</th><td></td></tr>
<tr><th id="79">79</th><td><u>#define <dfn class="macro" id="_M/DPL_USER" data-ref="_M/DPL_USER">DPL_USER</dfn>    0x3     // User DPL</u></td></tr>
<tr><th id="80">80</th><td></td></tr>
<tr><th id="81">81</th><td><i>// Application segment type bits</i></td></tr>
<tr><th id="82">82</th><td><u>#define <dfn class="macro" id="_M/STA_X" data-ref="_M/STA_X">STA_X</dfn>       0x8     // Executable segment</u></td></tr>
<tr><th id="83">83</th><td><u>#define <dfn class="macro" id="_M/STA_E" data-ref="_M/STA_E">STA_E</dfn>       0x4     // Expand down (non-executable segments)</u></td></tr>
<tr><th id="84">84</th><td><u>#define <dfn class="macro" id="_M/STA_C" data-ref="_M/STA_C">STA_C</dfn>       0x4     // Conforming code segment (executable only)</u></td></tr>
<tr><th id="85">85</th><td><u>#define <dfn class="macro" id="_M/STA_W" data-ref="_M/STA_W">STA_W</dfn>       0x2     // Writeable (non-executable segments)</u></td></tr>
<tr><th id="86">86</th><td><u>#define <dfn class="macro" id="_M/STA_R" data-ref="_M/STA_R">STA_R</dfn>       0x2     // Readable (executable segments)</u></td></tr>
<tr><th id="87">87</th><td><u>#define <dfn class="macro" id="_M/STA_A" data-ref="_M/STA_A">STA_A</dfn>       0x1     // Accessed</u></td></tr>
<tr><th id="88">88</th><td></td></tr>
<tr><th id="89">89</th><td><i>// System segment type bits</i></td></tr>
<tr><th id="90">90</th><td><u>#define <dfn class="macro" id="_M/STS_T16A" data-ref="_M/STS_T16A">STS_T16A</dfn>    0x1     // Available 16-bit TSS</u></td></tr>
<tr><th id="91">91</th><td><u>#define <dfn class="macro" id="_M/STS_LDT" data-ref="_M/STS_LDT">STS_LDT</dfn>     0x2     // Local Descriptor Table</u></td></tr>
<tr><th id="92">92</th><td><u>#define <dfn class="macro" id="_M/STS_T16B" data-ref="_M/STS_T16B">STS_T16B</dfn>    0x3     // Busy 16-bit TSS</u></td></tr>
<tr><th id="93">93</th><td><u>#define <dfn class="macro" id="_M/STS_CG16" data-ref="_M/STS_CG16">STS_CG16</dfn>    0x4     // 16-bit Call Gate</u></td></tr>
<tr><th id="94">94</th><td><u>#define <dfn class="macro" id="_M/STS_TG" data-ref="_M/STS_TG">STS_TG</dfn>      0x5     // Task Gate / Coum Transmitions</u></td></tr>
<tr><th id="95">95</th><td><u>#define <dfn class="macro" id="_M/STS_IG16" data-ref="_M/STS_IG16">STS_IG16</dfn>    0x6     // 16-bit Interrupt Gate</u></td></tr>
<tr><th id="96">96</th><td><u>#define <dfn class="macro" id="_M/STS_TG16" data-ref="_M/STS_TG16">STS_TG16</dfn>    0x7     // 16-bit Trap Gate</u></td></tr>
<tr><th id="97">97</th><td><u>#define <dfn class="macro" id="_M/STS_T32A" data-ref="_M/STS_T32A">STS_T32A</dfn>    0x9     // Available 32-bit TSS</u></td></tr>
<tr><th id="98">98</th><td><u>#define <dfn class="macro" id="_M/STS_T32B" data-ref="_M/STS_T32B">STS_T32B</dfn>    0xB     // Busy 32-bit TSS</u></td></tr>
<tr><th id="99">99</th><td><u>#define <dfn class="macro" id="_M/STS_CG32" data-ref="_M/STS_CG32">STS_CG32</dfn>    0xC     // 32-bit Call Gate</u></td></tr>
<tr><th id="100">100</th><td><u>#define <dfn class="macro" id="_M/STS_IG32" data-ref="_M/STS_IG32">STS_IG32</dfn>    0xE     // 32-bit Interrupt Gate</u></td></tr>
<tr><th id="101">101</th><td><u>#define <dfn class="macro" id="_M/STS_TG32" data-ref="_M/STS_TG32">STS_TG32</dfn>    0xF     // 32-bit Trap Gate</u></td></tr>
<tr><th id="102">102</th><td></td></tr>
<tr><th id="103">103</th><td><i>// A virtual address 'la' has a three-part structure as follows:</i></td></tr>
<tr><th id="104">104</th><td><i>//</i></td></tr>
<tr><th id="105">105</th><td><i>// +--------10------+-------10-------+---------12----------+</i></td></tr>
<tr><th id="106">106</th><td><i>// | Page Directory |   Page Table   | Offset within Page  |</i></td></tr>
<tr><th id="107">107</th><td><i>// |      Index     |      Index     |                     |</i></td></tr>
<tr><th id="108">108</th><td><i>// +----------------+----------------+---------------------+</i></td></tr>
<tr><th id="109">109</th><td><i>//  \--- PDX(va) --/ \--- PTX(va) --/ </i></td></tr>
<tr><th id="110">110</th><td><i></i></td></tr>
<tr><th id="111">111</th><td><i>// page directory index</i></td></tr>
<tr><th id="112">112</th><td><u>#define <dfn class="macro" id="_M/PDX" data-ref="_M/PDX">PDX</dfn>(va)         (((uint)(va) &gt;&gt; PDXSHIFT) &amp; 0x3FF)</u></td></tr>
<tr><th id="113">113</th><td></td></tr>
<tr><th id="114">114</th><td><i>// page table index</i></td></tr>
<tr><th id="115">115</th><td><u>#define <dfn class="macro" id="_M/PTX" data-ref="_M/PTX">PTX</dfn>(va)         (((uint)(va) &gt;&gt; PTXSHIFT) &amp; 0x3FF)</u></td></tr>
<tr><th id="116">116</th><td></td></tr>
<tr><th id="117">117</th><td><i>// construct virtual address from indexes and offset</i></td></tr>
<tr><th id="118">118</th><td><u>#define <dfn class="macro" id="_M/PGADDR" data-ref="_M/PGADDR">PGADDR</dfn>(d, t, o) ((uint)((d) &lt;&lt; PDXSHIFT | (t) &lt;&lt; PTXSHIFT | (o)))</u></td></tr>
<tr><th id="119">119</th><td></td></tr>
<tr><th id="120">120</th><td><i>// Page directory and page table constants.</i></td></tr>
<tr><th id="121">121</th><td><u>#define <dfn class="macro" id="_M/NPDENTRIES" data-ref="_M/NPDENTRIES">NPDENTRIES</dfn>      1024    // # directory entries per page directory</u></td></tr>
<tr><th id="122">122</th><td><u>#define <dfn class="macro" id="_M/NPTENTRIES" data-ref="_M/NPTENTRIES">NPTENTRIES</dfn>      1024    // # PTEs per page table</u></td></tr>
<tr><th id="123">123</th><td><u>#define <dfn class="macro" id="_M/PGSIZE" data-ref="_M/PGSIZE">PGSIZE</dfn>          4096    // bytes mapped by a page</u></td></tr>
<tr><th id="124">124</th><td></td></tr>
<tr><th id="125">125</th><td><u>#define <dfn class="macro" id="_M/PGSHIFT" data-ref="_M/PGSHIFT">PGSHIFT</dfn>         12      // log2(PGSIZE)</u></td></tr>
<tr><th id="126">126</th><td><u>#define <dfn class="macro" id="_M/PTXSHIFT" data-ref="_M/PTXSHIFT">PTXSHIFT</dfn>        12      // offset of PTX in a linear address</u></td></tr>
<tr><th id="127">127</th><td><u>#define <dfn class="macro" id="_M/PDXSHIFT" data-ref="_M/PDXSHIFT">PDXSHIFT</dfn>        22      // offset of PDX in a linear address</u></td></tr>
<tr><th id="128">128</th><td></td></tr>
<tr><th id="129">129</th><td><u>#define <dfn class="macro" id="_M/PGROUNDUP" data-ref="_M/PGROUNDUP">PGROUNDUP</dfn>(sz)  (((sz)+PGSIZE-1) &amp; ~(PGSIZE-1))</u></td></tr>
<tr><th id="130">130</th><td><u>#define <dfn class="macro" id="_M/PGROUNDDOWN" data-ref="_M/PGROUNDDOWN">PGROUNDDOWN</dfn>(a) (((a)) &amp; ~(PGSIZE-1))</u></td></tr>
<tr><th id="131">131</th><td></td></tr>
<tr><th id="132">132</th><td><i>// Page table/directory entry flags.</i></td></tr>
<tr><th id="133">133</th><td><u>#define <dfn class="macro" id="_M/PTE_P" data-ref="_M/PTE_P">PTE_P</dfn>           0x001   // Present</u></td></tr>
<tr><th id="134">134</th><td><u>#define <dfn class="macro" id="_M/PTE_W" data-ref="_M/PTE_W">PTE_W</dfn>           0x002   // Writeable</u></td></tr>
<tr><th id="135">135</th><td><u>#define <dfn class="macro" id="_M/PTE_U" data-ref="_M/PTE_U">PTE_U</dfn>           0x004   // User</u></td></tr>
<tr><th id="136">136</th><td><u>#define <dfn class="macro" id="_M/PTE_PWT" data-ref="_M/PTE_PWT">PTE_PWT</dfn>         0x008   // Write-Through</u></td></tr>
<tr><th id="137">137</th><td><u>#define <dfn class="macro" id="_M/PTE_PCD" data-ref="_M/PTE_PCD">PTE_PCD</dfn>         0x010   // Cache-Disable</u></td></tr>
<tr><th id="138">138</th><td><u>#define <dfn class="macro" id="_M/PTE_A" data-ref="_M/PTE_A">PTE_A</dfn>           0x020   // Accessed</u></td></tr>
<tr><th id="139">139</th><td><u>#define <dfn class="macro" id="_M/PTE_D" data-ref="_M/PTE_D">PTE_D</dfn>           0x040   // Dirty</u></td></tr>
<tr><th id="140">140</th><td><u>#define <dfn class="macro" id="_M/PTE_PS" data-ref="_M/PTE_PS">PTE_PS</dfn>          0x080   // Page Size</u></td></tr>
<tr><th id="141">141</th><td><u>#define <dfn class="macro" id="_M/PTE_MBZ" data-ref="_M/PTE_MBZ">PTE_MBZ</dfn>         0x180   // Bits must be zero</u></td></tr>
<tr><th id="142">142</th><td></td></tr>
<tr><th id="143">143</th><td><i>// Address in page table or page directory entry</i></td></tr>
<tr><th id="144">144</th><td><u>#define <dfn class="macro" id="_M/PTE_ADDR" data-ref="_M/PTE_ADDR">PTE_ADDR</dfn>(pte)   ((uint)(pte) &amp; ~0xFFF)</u></td></tr>
<tr><th id="145">145</th><td></td></tr>
<tr><th id="146">146</th><td><u>#<span data-ppcond="146">ifndef</span> <span class="macro" data-ref="_M/__ASSEMBLER__">__ASSEMBLER__</span></u></td></tr>
<tr><th id="147">147</th><td><b>typedef</b> <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="typedef" id="pte_t" title='pte_t' data-type='uint' data-ref="pte_t">pte_t</dfn>;</td></tr>
<tr><th id="148">148</th><td></td></tr>
<tr><th id="149">149</th><td><i>// Task state segment format</i></td></tr>
<tr><th id="150">150</th><td><b>struct</b> <dfn class="type def" id="taskstate" title='taskstate' data-ref="taskstate">taskstate</dfn> {</td></tr>
<tr><th id="151">151</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::link" title='taskstate::link' data-ref="taskstate::link">link</dfn>;         <i>// Old ts selector</i></td></tr>
<tr><th id="152">152</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::esp0" title='taskstate::esp0' data-ref="taskstate::esp0">esp0</dfn>;         <i>// Stack pointers and segment selectors</i></td></tr>
<tr><th id="153">153</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::ss0" title='taskstate::ss0' data-ref="taskstate::ss0">ss0</dfn>;        <i>//   after an increase in privilege level</i></td></tr>
<tr><th id="154">154</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding1" title='taskstate::padding1' data-ref="taskstate::padding1">padding1</dfn>;</td></tr>
<tr><th id="155">155</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> *<dfn class="decl" id="taskstate::esp1" title='taskstate::esp1' data-ref="taskstate::esp1">esp1</dfn>;</td></tr>
<tr><th id="156">156</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::ss1" title='taskstate::ss1' data-ref="taskstate::ss1">ss1</dfn>;</td></tr>
<tr><th id="157">157</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding2" title='taskstate::padding2' data-ref="taskstate::padding2">padding2</dfn>;</td></tr>
<tr><th id="158">158</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> *<dfn class="decl" id="taskstate::esp2" title='taskstate::esp2' data-ref="taskstate::esp2">esp2</dfn>;</td></tr>
<tr><th id="159">159</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::ss2" title='taskstate::ss2' data-ref="taskstate::ss2">ss2</dfn>;</td></tr>
<tr><th id="160">160</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding3" title='taskstate::padding3' data-ref="taskstate::padding3">padding3</dfn>;</td></tr>
<tr><th id="161">161</th><td>  <em>void</em> *<dfn class="decl" id="taskstate::cr3" title='taskstate::cr3' data-ref="taskstate::cr3">cr3</dfn>;         <i>// Page directory base</i></td></tr>
<tr><th id="162">162</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> *<dfn class="decl" id="taskstate::eip" title='taskstate::eip' data-ref="taskstate::eip">eip</dfn>;         <i>// Saved state from last task switch</i></td></tr>
<tr><th id="163">163</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::eflags" title='taskstate::eflags' data-ref="taskstate::eflags">eflags</dfn>;</td></tr>
<tr><th id="164">164</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::eax" title='taskstate::eax' data-ref="taskstate::eax">eax</dfn>;          <i>// More saved state (registers)</i></td></tr>
<tr><th id="165">165</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::ecx" title='taskstate::ecx' data-ref="taskstate::ecx">ecx</dfn>;</td></tr>
<tr><th id="166">166</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::edx" title='taskstate::edx' data-ref="taskstate::edx">edx</dfn>;</td></tr>
<tr><th id="167">167</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::ebx" title='taskstate::ebx' data-ref="taskstate::ebx">ebx</dfn>;</td></tr>
<tr><th id="168">168</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> *<dfn class="decl" id="taskstate::esp" title='taskstate::esp' data-ref="taskstate::esp">esp</dfn>;</td></tr>
<tr><th id="169">169</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> *<dfn class="decl" id="taskstate::ebp" title='taskstate::ebp' data-ref="taskstate::ebp">ebp</dfn>;</td></tr>
<tr><th id="170">170</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::esi" title='taskstate::esi' data-ref="taskstate::esi">esi</dfn>;</td></tr>
<tr><th id="171">171</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="taskstate::edi" title='taskstate::edi' data-ref="taskstate::edi">edi</dfn>;</td></tr>
<tr><th id="172">172</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::es" title='taskstate::es' data-ref="taskstate::es">es</dfn>;         <i>// Even more saved state (segment selectors)</i></td></tr>
<tr><th id="173">173</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding4" title='taskstate::padding4' data-ref="taskstate::padding4">padding4</dfn>;</td></tr>
<tr><th id="174">174</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::cs" title='taskstate::cs' data-ref="taskstate::cs">cs</dfn>;</td></tr>
<tr><th id="175">175</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding5" title='taskstate::padding5' data-ref="taskstate::padding5">padding5</dfn>;</td></tr>
<tr><th id="176">176</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::ss" title='taskstate::ss' data-ref="taskstate::ss">ss</dfn>;</td></tr>
<tr><th id="177">177</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding6" title='taskstate::padding6' data-ref="taskstate::padding6">padding6</dfn>;</td></tr>
<tr><th id="178">178</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::ds" title='taskstate::ds' data-ref="taskstate::ds">ds</dfn>;</td></tr>
<tr><th id="179">179</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding7" title='taskstate::padding7' data-ref="taskstate::padding7">padding7</dfn>;</td></tr>
<tr><th id="180">180</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::fs" title='taskstate::fs' data-ref="taskstate::fs">fs</dfn>;</td></tr>
<tr><th id="181">181</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding8" title='taskstate::padding8' data-ref="taskstate::padding8">padding8</dfn>;</td></tr>
<tr><th id="182">182</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::gs" title='taskstate::gs' data-ref="taskstate::gs">gs</dfn>;</td></tr>
<tr><th id="183">183</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding9" title='taskstate::padding9' data-ref="taskstate::padding9">padding9</dfn>;</td></tr>
<tr><th id="184">184</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::ldt" title='taskstate::ldt' data-ref="taskstate::ldt">ldt</dfn>;</td></tr>
<tr><th id="185">185</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::padding10" title='taskstate::padding10' data-ref="taskstate::padding10">padding10</dfn>;</td></tr>
<tr><th id="186">186</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::t" title='taskstate::t' data-ref="taskstate::t">t</dfn>;          <i>// Trap on task switch</i></td></tr>
<tr><th id="187">187</th><td>  <a class="typedef" href="types.h.html#ushort" title='ushort' data-type='unsigned short' data-ref="ushort">ushort</a> <dfn class="decl" id="taskstate::iomb" title='taskstate::iomb' data-ref="taskstate::iomb">iomb</dfn>;       <i>// I/O map base address</i></td></tr>
<tr><th id="188">188</th><td>};</td></tr>
<tr><th id="189">189</th><td></td></tr>
<tr><th id="190">190</th><td><i>// PAGEBREAK: 12</i></td></tr>
<tr><th id="191">191</th><td><i>// Gate descriptors for interrupts and traps</i></td></tr>
<tr><th id="192">192</th><td><b>struct</b> <dfn class="type def" id="gatedesc" title='gatedesc' data-ref="gatedesc">gatedesc</dfn> {</td></tr>
<tr><th id="193">193</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::off_15_0" title='gatedesc::off_15_0' data-ref="gatedesc::off_15_0">off_15_0</dfn> : <var>16</var>;   <i>// low 16 bits of offset in segment</i></td></tr>
<tr><th id="194">194</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::cs" title='gatedesc::cs' data-ref="gatedesc::cs">cs</dfn> : <var>16</var>;         <i>// code segment selector</i></td></tr>
<tr><th id="195">195</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::args" title='gatedesc::args' data-ref="gatedesc::args">args</dfn> : <var>5</var>;        <i>// # args, 0 for interrupt/trap gates</i></td></tr>
<tr><th id="196">196</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::rsv1" title='gatedesc::rsv1' data-ref="gatedesc::rsv1">rsv1</dfn> : <var>3</var>;        <i>// reserved(should be zero I guess)</i></td></tr>
<tr><th id="197">197</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::type" title='gatedesc::type' data-ref="gatedesc::type">type</dfn> : <var>4</var>;        <i>// type(STS_{TG,IG32,TG32})</i></td></tr>
<tr><th id="198">198</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::s" title='gatedesc::s' data-ref="gatedesc::s">s</dfn> : <var>1</var>;           <i>// must be 0 (system)</i></td></tr>
<tr><th id="199">199</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::dpl" title='gatedesc::dpl' data-ref="gatedesc::dpl">dpl</dfn> : <var>2</var>;         <i>// descriptor(meaning new) privilege level</i></td></tr>
<tr><th id="200">200</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::p" title='gatedesc::p' data-ref="gatedesc::p">p</dfn> : <var>1</var>;           <i>// Present</i></td></tr>
<tr><th id="201">201</th><td>  <a class="typedef" href="types.h.html#uint" title='uint' data-type='unsigned int' data-ref="uint">uint</a> <dfn class="decl" id="gatedesc::off_31_16" title='gatedesc::off_31_16' data-ref="gatedesc::off_31_16">off_31_16</dfn> : <var>16</var>;  <i>// high bits of offset in segment</i></td></tr>
<tr><th id="202">202</th><td>};</td></tr>
<tr><th id="203">203</th><td></td></tr>
<tr><th id="204">204</th><td><i>// Set up a normal interrupt/trap gate descriptor.</i></td></tr>
<tr><th id="205">205</th><td><i>// - istrap: 1 for a trap (= exception) gate, 0 for an interrupt gate.</i></td></tr>
<tr><th id="206">206</th><td><i>//   interrupt gate clears FL_IF, trap gate leaves FL_IF alone</i></td></tr>
<tr><th id="207">207</th><td><i>// - sel: Code segment selector for interrupt/trap handler</i></td></tr>
<tr><th id="208">208</th><td><i>// - off: Offset in code segment for interrupt/trap handler</i></td></tr>
<tr><th id="209">209</th><td><i>// - dpl: Descriptor Privilege Level -</i></td></tr>
<tr><th id="210">210</th><td><i>//        the privilege level required for software to invoke</i></td></tr>
<tr><th id="211">211</th><td><i>//        this interrupt/trap gate explicitly using an int instruction.</i></td></tr>
<tr><th id="212">212</th><td><u>#define <dfn class="macro" id="_M/SETGATE" data-ref="_M/SETGATE">SETGATE</dfn>(gate, istrap, sel, off, d)                \</u></td></tr>
<tr><th id="213">213</th><td><u>{                                                         \</u></td></tr>
<tr><th id="214">214</th><td><u>  (gate).off_15_0 = (uint)(off) &amp; 0xffff;                \</u></td></tr>
<tr><th id="215">215</th><td><u>  (gate).cs = (sel);                                      \</u></td></tr>
<tr><th id="216">216</th><td><u>  (gate).args = 0;                                        \</u></td></tr>
<tr><th id="217">217</th><td><u>  (gate).rsv1 = 0;                                        \</u></td></tr>
<tr><th id="218">218</th><td><u>  (gate).type = (istrap) ? STS_TG32 : STS_IG32;           \</u></td></tr>
<tr><th id="219">219</th><td><u>  (gate).s = 0;                                           \</u></td></tr>
<tr><th id="220">220</th><td><u>  (gate).dpl = (d);                                       \</u></td></tr>
<tr><th id="221">221</th><td><u>  (gate).p = 1;                                           \</u></td></tr>
<tr><th id="222">222</th><td><u>  (gate).off_31_16 = (uint)(off) &gt;&gt; 16;                  \</u></td></tr>
<tr><th id="223">223</th><td><u>}</u></td></tr>
<tr><th id="224">224</th><td></td></tr>
<tr><th id="225">225</th><td><u>#<span data-ppcond="146">endif</span></u></td></tr>
<tr><th id="226">226</th><td></td></tr>
</table><hr/><p id='footer'>
Generated while processing <a href='console.c.html'>codebrowser/console.c</a><br/>Generated on <em>2017-Aug-31</em> from project codebrowser revision <em>xv6-rev7</em><br />Powered by <a href='https://woboq.com'><img alt='Woboq' src='https://code.woboq.org/woboq-16.png' width='41' height='16' /></a> <a href='https://code.woboq.org'>Code Browser</a> 2.1
<br/>Generator usage only permitted with license.</p>
</div></body></html>
